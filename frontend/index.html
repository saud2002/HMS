<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HMS Dashboard - Hospital Management System</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <div class="sidebar" id="sidebar"></div>
    <div class="topbar" id="topbar"></div>

    <div class="main-content">
        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon blue">
                    <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                </div>
                <div class="stat-details">
                    <h3 id="statPatients">0</h3>
                    <p>Total Patients</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon green">
                    <svg viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/></svg>
                </div>
                <div class="stat-details">
                    <h3 id="statAppointments">0</h3>
                    <p>Today's Appointments</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon purple">
                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6z"/></svg>
                </div>
                <div class="stat-details">
                    <h3 id="statDoctors">0</h3>
                    <p>Active Doctors</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon orange">
                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"/></svg>
                </div>
                <div class="stat-details">
                    <h3 id="statRevenue">Rs.0</h3>
                    <p>Today's Revenue</p>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <div class="card-title">âš¡ Quick Actions</div>
            <div class="quick-actions">
                <a href="patients.html?action=add" class="action-btn">
                    <svg viewBox="0 0 24 24"><path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                    Register Patient & Book Appointment
                </a>
                <a href="/appointments.html" class="action-btn">
                    <svg viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/></svg>
                    New Appointment
                </a>
                <a href="doctors.html?action=add" class="action-btn">
                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6z"/></svg>
                    Add Doctor
                </a>
                <a href="/reports.html" class="action-btn">
                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>
                    View Reports
                </a>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="card">
            <div class="card-title">ðŸ“Š Recent Activity</div>
            <div id="activityList"></div>
        </div>
    </div>

    <script src="/static/js/data.js"></script>
    <script src="/static/js/common.js"></script>
    <script>
        // Update stats
        async function updateStats() {
            try {
                const stats = await API.Dashboard.getStats();
                document.getElementById('statPatients').textContent = stats.total_patients;
                document.getElementById('statDoctors').textContent = stats.total_doctors;
                document.getElementById('statAppointments').textContent = stats.today_appointments;
                document.getElementById('statRevenue').textContent = 'Rs. ' + stats.today_revenue.toLocaleString();
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
                // Set default values on error
                document.getElementById('statPatients').textContent = '0';
                document.getElementById('statDoctors').textContent = '0';
                document.getElementById('statAppointments').textContent = '0';
                document.getElementById('statRevenue').textContent = 'Rs. 0';
            }
        }

        // Render activities
        function renderActivities() {
            const activities = HMS.activities.getAll();
            const icons = {
                patient: '<path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>',
                appointment: '<path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>',
                default: '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>'
            };

            document.getElementById('activityList').innerHTML = activities.map(a => {
                const text = a.text.toLowerCase();
                const icon = text.includes('patient') ? icons.patient : 
                             text.includes('appointment') ? icons.appointment : icons.default;
                return `
                    <div class="activity-item">
                        <div class="activity-icon"><svg viewBox="0 0 24 24">${icon}</svg></div>
                        <div>
                            <div class="activity-title">${a.text}</div>
                            <div class="activity-time">${getTimeAgo(a.time)}</div>
                        </div>
                    </div>
                `;
            }).join('') || '<p style="color:#64748b; padding: 20px;">No recent activity</p>';
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            renderActivities();
        });
    </script>
    <script src="/static/js/api.js"></script>
</body>
</html>