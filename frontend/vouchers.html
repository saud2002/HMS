<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor Payments & Expenses - HMS</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <div class="sidebar" id="sidebar"></div>
    <div class="topbar" id="topbar"></div>

    <div class="main-content">
        <!-- Header Section -->
        <div class="card no-print">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                <h2 style="margin: 0; color: #1e40af;"><i class="fas fa-receipt" style="margin-right: 8px;"></i>Doctor Payments & Expenses</h2>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="showCreateVoucherModal('DOCTOR_PAYMENT')">
                        <i class="fas fa-plus" style="margin-right: 4px;"></i>Doctor Payment
                    </button>
                    <button class="btn btn-warning" onclick="showCreateVoucherModal('HOSPITAL_EXPENSE')">
                        <i class="fas fa-plus" style="margin-right: 4px;"></i>Hospital Expense
                    </button>
                    <button class="btn btn-info" onclick="showCreateVoucherModal('ADJUSTMENT')">
                        <i class="fas fa-plus" style="margin-right: 4px;"></i>Adjustment
                    </button>
                </div>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="stats-grid" style="margin-bottom: 30px;">
            <div class="stat-card">
                <div class="stat-icon blue">
                    <svg viewBox="0 0 24 24"><path d="M4 4h16v2H4zm0 4h16v2H4zm0 4h16v2H4zm0 4h10v2H4z"/></svg>
                </div>
                <div class="stat-details">
                    <h3 id="totalVouchers">0</h3>
                    <p>Total Vouchers</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon orange">
                    <svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                </div>
                <div class="stat-details">
                    <h3 id="pendingApproval">0</h3>
                    <p>Pending Approval</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon green">
                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                </div>
                <div class="stat-details">
                    <h3 id="approvedCount">0</h3>
                    <p>Approved</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon purple">
                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"/></svg>
                </div>
                <div class="stat-details">
                    <h3 id="totalAmount">LKR 0</h3>
                    <p>Total Amount</p>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="card" style="margin-bottom: 30px;">
            <div class="card-title">üîç Filter Vouchers</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <div>
                    <label for="filterType" style="display: block; margin-bottom: 8px; font-weight: 600; color: #334155;">Voucher Type</label>
                    <select id="filterType" onchange="loadVouchers()" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                        <option value="">All Types</option>
                        <option value="DOCTOR_PAYMENT">Doctor Payment</option>
                        <option value="HOSPITAL_EXPENSE">Hospital Expense</option>
                        <option value="ADJUSTMENT">Adjustment</option>
                    </select>
                </div>
                <div>
                    <label for="filterStatus" style="display: block; margin-bottom: 8px; font-weight: 600; color: #334155;">Status</label>
                    <select id="filterStatus" onchange="loadVouchers()" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                        <option value="">All Status</option>
                        <option value="DRAFT">Draft</option>
                        <option value="PENDING_APPROVAL">Pending Approval</option>
                        <option value="APPROVED">Approved</option>
                        <option value="PAID">Paid</option>
                        <option value="REJECTED">Rejected</option>
                    </select>
                </div>
                <div>
                    <label for="filterDoctor" style="display: block; margin-bottom: 8px; font-weight: 600; color: #334155;">Doctor</label>
                    <select id="filterDoctor" onchange="loadVouchers()" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                        <option value="">All Doctors</option>
                    </select>
                </div>
                <div>
                    <label for="filterDateFrom" style="display: block; margin-bottom: 8px; font-weight: 600; color: #334155;">Date From</label>
                    <input type="date" id="filterDateFrom" onchange="loadVouchers()" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                </div>
            </div>
        </div>

        <!-- Vouchers Table -->
        <div class="card">
            <div class="card-title">üìã Voucher Management</div>
            <div style="overflow-x: auto;">
                <table class="voucher-table">
                    <thead>
                        <tr>
                            <th>Voucher #</th>
                            <th>Type</th>
                            <th>Doctor</th>
                            <th>Amount</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="vouchersTableBody">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px; color: #64748b;">Loading vouchers...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Create Voucher Modal -->
    <div class="modal" id="createVoucherModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 id="createVoucherModalTitle">Create Voucher</h3>
                <button class="close-btn" onclick="closeModal('createVoucherModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createVoucherForm">
                    <input type="hidden" id="voucherType" name="voucher_type">
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <label for="voucherDate" style="display: block; margin-bottom: 8px; font-weight: 600; color: #334155;">Voucher Date</label>
                            <input type="date" id="voucherDate" name="voucher_date" required style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div>
                            <label for="amount" style="display: block; margin-bottom: 8px; font-weight: 600; color: #334155;">Amount (LKR)</label>
                            <input type="number" id="amount" name="amount" step="0.01" min="0" required style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                        </div>
                    </div>

                    <div id="doctorSection" style="display: none; margin-bottom: 20px;">
                        <label for="doctorId" style="display: block; margin-bottom: 8px; font-weight: 600; color: #334155;">Doctor</label>
                        <select id="doctorId" name="doctor_id" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                            <option value="">Select Doctor</option>
                        </select>
                    </div>

                    <div id="paymentPeriodSection" style="display: none; margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <label for="paymentPeriodStart" style="display: block; margin-bottom: 8px; font-weight: 600; color: #334155;">Payment Period Start</label>
                                <input type="date" id="paymentPeriodStart" name="payment_period_start" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                            </div>
                            <div>
                                <label for="paymentPeriodEnd" style="display: block; margin-bottom: 8px; font-weight: 600; color: #334155;">Payment Period End</label>
                                <input type="date" id="paymentPeriodEnd" name="payment_period_end" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label for="description" style="display: block; margin-bottom: 8px; font-weight: 600; color: #334155;">Description</label>
                        <textarea id="description" name="description" rows="3" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; resize: vertical;"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('createVoucherModal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="createVoucher()">Create Voucher</button>
            </div>
        </div>
    </div>

    <!-- View Voucher Modal -->
    <div class="modal" id="viewVoucherModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>Voucher Details</h3>
                <button class="close-btn" onclick="closeModal('viewVoucherModal')">&times;</button>
            </div>
            <div class="modal-body" id="voucherDetailsContent">
                <!-- Voucher details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('viewVoucherModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/static/js/common.js"></script>
    <script src="/static/js/vouchers.js"></script>
</body>
</html>