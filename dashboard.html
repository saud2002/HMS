<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HMS Dashboard - Hospital Management System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f1f5f9; color: #334155; }
        
        .sidebar {
            position: fixed; left: 0; top: 0; height: 100vh; width: 260px;
            background: linear-gradient(180deg, #1e40af 0%, #1e3a8a 100%);
            padding: 20px 0; transition: all 0.3s; z-index: 1000;
        }
        .sidebar.collapsed { width: 80px; }
        .logo-section { padding: 0 20px 30px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .logo-icon { width: 50px; height: 50px; background: rgba(255,255,255,0.2); border-radius: 12px; display: inline-flex; align-items: center; justify-content: center; margin-bottom: 10px; }
        .logo-icon svg { width: 30px; height: 30px; fill: white; }
        .logo-text { color: white; font-size: 18px; font-weight: 600; }
        .sidebar.collapsed .logo-text, .sidebar.collapsed .menu-item span { display: none; }
        .menu { margin-top: 30px; padding: 0 10px; }
        .menu-item { display: flex; align-items: center; padding: 14px 20px; color: rgba(255,255,255,0.8); text-decoration: none; border-radius: 10px; margin-bottom: 8px; cursor: pointer; transition: all 0.3s; }
        .menu-item:hover { background: rgba(255,255,255,0.1); color: white; transform: translateX(5px); }
        .menu-item.active { background: rgba(255,255,255,0.2); color: white; }
        .menu-item svg { width: 22px; height: 22px; margin-right: 15px; min-width: 22px; fill: currentColor; }
        
        .topbar {
            position: fixed; top: 0; left: 260px; right: 0; height: 70px; background: white;
            display: flex; align-items: center; justify-content: space-between; padding: 0 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); z-index: 999; transition: left 0.3s;
        }
        .sidebar.collapsed ~ .topbar { left: 80px; }
        .topbar-left { display: flex; align-items: center; gap: 20px; }
        .toggle-btn { width: 40px; height: 40px; background: #f1f5f9; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .toggle-btn:hover { background: #e2e8f0; }
        .page-title { font-size: 24px; font-weight: 600; color: #1e40af; }
        .topbar-right { display: flex; align-items: center; gap: 20px; }
        .date-time { font-size: 14px; color: #64748b; }
        .user-profile { display: flex; align-items: center; gap: 12px; padding: 8px 16px; background: #f1f5f9; border-radius: 50px; cursor: pointer; }
        .user-avatar { width: 38px; height: 38px; background: linear-gradient(135deg, #2563eb, #1e40af); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; }
        .user-info { display: flex; flex-direction: column; }
        .user-name { font-size: 14px; font-weight: 600; color: #334155; }
        .user-role { font-size: 12px; color: #64748b; }
        
        .main-content { margin-left: 260px; margin-top: 70px; padding: 30px; transition: margin-left 0.3s; min-height: calc(100vh - 70px); }
        .sidebar.collapsed ~ .topbar ~ .main-content { margin-left: 80px; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 20px; transition: all 0.3s; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .stat-icon { width: 60px; height: 60px; border-radius: 12px; display: flex; align-items: center; justify-content: center; }
        .stat-icon.blue { background: linear-gradient(135deg, #dbeafe, #bfdbfe); }
        .stat-icon.green { background: linear-gradient(135deg, #dcfce7, #bbf7d0); }
        .stat-icon.purple { background: linear-gradient(135deg, #e9d5ff, #d8b4fe); }
        .stat-icon.orange { background: linear-gradient(135deg, #fed7aa, #fdba74); }
        .stat-icon svg { width: 30px; height: 30px; }
        .stat-icon.blue svg { fill: #2563eb; }
        .stat-icon.green svg { fill: #16a34a; }
        .stat-icon.purple svg { fill: #9333ea; }
        .stat-icon.orange svg { fill: #ea580c; }
        .stat-details h3 { font-size: 28px; font-weight: 700; color: #1e293b; margin-bottom: 5px; }
        .stat-details p { font-size: 14px; color: #64748b; }
        
        .content-section { display: none; }
        .content-section.active { display: block; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .card-title { font-size: 18px; font-weight: 600; color: #1e293b; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 14px; font-weight: 500; color: #475569; margin-bottom: 8px; }
        .form-group input, .form-group select { width: 100%; padding: 12px 15px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; transition: all 0.3s; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }
        .form-group input:read-only { background: #f8fafc; }
        
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, #2563eb, #1e40af); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(37,99,235,0.4); }
        .btn-success { background: linear-gradient(135deg, #16a34a, #15803d); color: white; }
        .btn-success:hover { box-shadow: 0 5px 15px rgba(22,163,74,0.4); }
        .btn-danger { background: linear-gradient(135deg, #dc2626, #b91c1c); color: white; }
        .btn-secondary { background: #64748b; color: white; }
        .btn-sm { padding: 8px 16px; font-size: 13px; }
        
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #f1f5f9; }
        th { background: #f8fafc; font-weight: 600; color: #475569; font-size: 13px; text-transform: uppercase; }
        tr:hover { background: #f8fafc; }
        .status-badge { padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .status-active { background: #dcfce7; color: #16a34a; }
        .status-inactive { background: #fee2e2; color: #dc2626; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 15px; padding: 30px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-header h2 { font-size: 20px; color: #1e293b; }
        .modal-close { width: 35px; height: 35px; border: none; background: #f1f5f9; border-radius: 8px; cursor: pointer; font-size: 20px; }
        
        .search-box { display: flex; gap: 10px; margin-bottom: 20px; }
        .search-box input { flex: 1; padding: 12px 15px; border: 1px solid #e2e8f0; border-radius: 8px; }
        
        .bill-section { border: 2px solid #e2e8f0; border-radius: 10px; padding: 20px; margin: 15px 0; }
        .bill-header { text-align: center; border-bottom: 2px dashed #e2e8f0; padding-bottom: 15px; margin-bottom: 15px; }
        .bill-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f1f5f9; }
        .bill-total { font-size: 18px; font-weight: 700; color: #1e40af; border-top: 2px solid #1e40af; margin-top: 10px; padding-top: 10px; }
        
        .token-display { background: linear-gradient(135deg, #2563eb, #1e40af); color: white; padding: 20px; border-radius: 10px; text-align: center; margin: 15px 0; }
        .token-number { font-size: 32px; font-weight: 700; }
        
        .tab-buttons { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab-btn { padding: 10px 20px; border: 2px solid #e2e8f0; background: white; border-radius: 8px; cursor: pointer; font-weight: 500; }
        .tab-btn.active { border-color: #2563eb; background: #eff6ff; color: #2563eb; }
        
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 15px; }
        .checkbox-item { display: flex; align-items: center; gap: 8px; }
        .checkbox-item input { width: 18px; height: 18px; }
        
        .quick-actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .action-btn { padding: 15px 20px; background: linear-gradient(135deg, #2563eb, #1e40af); color: white; border: none; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .action-btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(37,99,235,0.4); }
        .action-btn svg { width: 20px; height: 20px; fill: currentColor; }
        
        .activity-item { display: flex; align-items: center; gap: 15px; padding: 15px; border-bottom: 1px solid #f1f5f9; }
        .activity-icon { width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; background: #f1f5f9; }
        .activity-icon svg { width: 20px; height: 20px; fill: #2563eb; }
        .activity-title { font-size: 14px; font-weight: 600; color: #1e293b; }
        .activity-time { font-size: 13px; color: #64748b; }
        
        @media print {
            .sidebar, .topbar, .no-print { display: none !important; }
            .main-content { margin: 0 !important; padding: 20px !important; }
            .bill-section { border: 1px solid #000; }
        }
        @media (max-width: 768px) {
            .sidebar { width: 80px; }
            .sidebar .logo-text, .sidebar .menu-item span { display: none; }
            .topbar { left: 80px; }
            .main-content { margin-left: 80px; }
        }
    </style>
</head>
<body>
    <div class="sidebar" id="sidebar">
        <div class="logo-section">
            <div class="logo-icon">
                <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-1 11h-4v4h-4v-4H6v-4h4V6h4v4h4v4z"/></svg>
            </div>
            <div class="logo-text">HMS Portal</div>
        </div>
        <div class="menu">
            <a class="menu-item active" data-page="dashboard">
                <svg viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
                <span>Dashboard</span>
            </a>
            <a class="menu-item" data-page="patients">
                <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                <span>Patients</span>
            </a>
            <a class="menu-item" data-page="doctors">
                <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"/></svg>
                <span>Doctors</span>
            </a>
            <a class="menu-item" data-page="appointments">
                <svg viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/></svg>
                <span>Appointments</span>
            </a>
            <a class="menu-item" data-page="reports">
                <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>
                <span>Reports</span>
            </a>
        </div>
    </div>

    <div class="topbar">
        <div class="topbar-left">
            <button class="toggle-btn" id="toggleSidebar">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#334155" stroke-width="2">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
            <h1 class="page-title" id="pageTitle">Dashboard</h1>
        </div>
        <div class="topbar-right">
            <div class="date-time" id="dateTime"></div>
            <div class="user-profile">
                <div class="user-avatar">A</div>
                <div class="user-info">
                    <div class="user-name">Admin User</div>
                    <div class="user-role">System Administrator</div>
                </div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <!-- Dashboard Section -->
        <div class="content-section active" id="dashboardSection">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon blue"><svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg></div>
                    <div class="stat-details"><h3 id="statPatients">0</h3><p>Total Patients</p></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon green"><svg viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/></svg></div>
                    <div class="stat-details"><h3 id="statAppointments">0</h3><p>Today's Appointments</p></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon purple"><svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6z"/></svg></div>
                    <div class="stat-details"><h3 id="statDoctors">0</h3><p>Active Doctors</p></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orange"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"/></svg></div>
                    <div class="stat-details"><h3 id="statRevenue">$0</h3><p>Today's Revenue</p></div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">‚ö° Quick Actions</div>
                <div class="quick-actions">
                    <button class="action-btn" onclick="switchPage('patients'); openPatientModal()">
                        <svg viewBox="0 0 24 24"><path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                        Register New Patient
                    </button>
                    <button class="action-btn" onclick="switchPage('appointments')">
                        <svg viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/></svg>
                        New Appointment
                    </button>
                    <button class="action-btn" onclick="switchPage('doctors'); openDoctorModal()">
                        <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6z"/></svg>
                        Add Doctor
                    </button>
                    <button class="action-btn" onclick="switchPage('reports')">
                        <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>
                        View Reports
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">üìä Recent Activity</div>
                <div id="activityList"></div>
            </div>
        </div>

        <!-- Patients Section -->
        <div class="content-section" id="patientsSection">
            <div class="card no-print">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                    <div class="search-box" style="flex: 1; min-width: 250px; margin: 0;">
                        <input type="text" id="patientSearch" placeholder="Search by name, NIC, or phone..." onkeyup="searchPatients()">
                    </div>
                    <button class="btn btn-primary" onclick="openPatientModal()">+ Add New Patient</button>
                </div>
            </div>
            <div class="card">
                <div class="card-title">üë• Patient Records</div>
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr><th>Patient ID</th><th>Name</th><th>Age</th><th>Gender</th><th>Phone</th><th>NIC</th><th>Reg. Date</th><th>Actions</th></tr>
                        </thead>
                        <tbody id="patientsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Doctors Section -->
        <div class="content-section" id="doctorsSection">
            <div class="card no-print">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                    <div class="search-box" style="flex: 1; min-width: 250px; margin: 0;">
                        <input type="text" id="doctorSearch" placeholder="Search by name or specialization..." onkeyup="searchDoctors()">
                    </div>
                    <button class="btn btn-primary" onclick="openDoctorModal()">+ Add New Doctor</button>
                </div>
            </div>
            <div class="card">
                <div class="card-title">üë®‚Äç‚öïÔ∏è Doctor Profiles</div>
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr><th>Doctor ID</th><th>Name</th><th>Specialization</th><th>Consultation Fee</th><th>Status</th><th>Actions</th></tr>
                        </thead>
                        <tbody id="doctorsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Appointments Section -->
        <div class="content-section" id="appointmentsSection">
            <div class="tab-buttons no-print">
                <button class="tab-btn active" onclick="showAppointmentTab('new')">New Appointment</button>
                <button class="tab-btn" onclick="showAppointmentTab('list')">Today's Appointments</button>
                <button class="tab-btn" onclick="showAppointmentTab('all')">All Appointments</button>
            </div>
            
            <div id="appointmentNewTab">
                <div class="card">
                    <div class="card-title">üìÖ Create New Appointment</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Select Patient *</label>
                            <select id="appointmentPatient" onchange="fillPatientDetails()">
                                <option value="">-- Select Patient --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Patient Name</label>
                            <input type="text" id="appointmentPatientName" readonly>
                        </div>
                        <div class="form-group">
                            <label>Age</label>
                            <input type="text" id="appointmentPatientAge" readonly>
                        </div>
                        <div class="form-group">
                            <label>Select Doctor *</label>
                            <select id="appointmentDoctor" onchange="fillDoctorDetails()">
                                <option value="">-- Select Doctor --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Specialization</label>
                            <input type="text" id="appointmentSpecialization" readonly>
                        </div>
                        <div class="form-group">
                            <label>Consultation Fee</label>
                            <input type="text" id="appointmentDoctorFee" readonly>
                        </div>
                    </div>
                    
                    <div class="card-title" style="margin-top: 20px;">üí∞ Charges</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Hospital Charges ($)</label>
                            <input type="number" id="hospitalCharges" value="50" min="0">
                        </div>
                    </div>
                    
                    <div class="card-title" style="margin-top: 20px;">ü©∫ Additional Services</div>
                    <div class="checkbox-group">
                        <label class="checkbox-item"><input type="checkbox" id="svcDressing" value="25"> Dressing ($25)</label>
                        <label class="checkbox-item"><input type="checkbox" id="svcScanning" value="150"> Scanning ($150)</label>
                        <label class="checkbox-item"><input type="checkbox" id="svcBlood" value="75"> Blood Testing ($75)</label>
                        <label class="checkbox-item"><input type="checkbox" id="svcECG" value="100"> ECG ($100)</label>
                        <label class="checkbox-item"><input type="checkbox" id="svcOther" value="0"> Other</label>
                    </div>
                    <div class="form-group" id="otherServiceGroup" style="display: none; margin-top: 15px;">
                        <label>Other Service Amount ($)</label>
                        <input type="number" id="otherServiceAmount" value="0" min="0">
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn btn-success" onclick="createAppointment()">Generate Bill & Token</button>
                    </div>
                </div>
            </div>
            
            <div id="appointmentListTab" style="display: none;">
                <div class="card">
                    <div class="card-title">üìã Today's Appointments</div>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead><tr><th>Token</th><th>Patient</th><th>Doctor</th><th>Time</th><th>Total</th><th>Actions</th></tr></thead>
                            <tbody id="todayAppointmentsTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div id="appointmentAllTab" style="display: none;">
                <div class="card">
                    <div class="card-title">üìã All Appointments</div>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead><tr><th>Token</th><th>Patient</th><th>Doctor</th><th>Date</th><th>Total</th><th>Actions</th></tr></thead>
                            <tbody id="allAppointmentsTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div class="content-section" id="reportsSection">
            <div class="tab-buttons no-print">
                <button class="tab-btn active" onclick="showReportTab('doctor')">Doctor Report</button>
                <button class="tab-btn" onclick="showReportTab('hospital')">Hospital Report</button>
            </div>
            
            <div id="doctorReportTab">
                <div class="card no-print">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Select Doctor</label>
                            <select id="reportDoctor"><option value="">-- All Doctors --</option></select>
                        </div>
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="reportDate">
                        </div>
                        <div class="form-group" style="display: flex; align-items: flex-end;">
                            <button class="btn btn-primary" onclick="generateDoctorReport()">Generate Report</button>
                        </div>
                    </div>
                </div>
                <div class="card" id="doctorReportContent" style="display: none;"></div>
            </div>
            
            <div id="hospitalReportTab" style="display: none;">
                <div class="card no-print">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="hospitalReportDate">
                        </div>
                        <div class="form-group" style="display: flex; align-items: flex-end;">
                            <button class="btn btn-primary" onclick="generateHospitalReport()">Generate Report</button>
                        </div>
                    </div>
                </div>
                <div class="card" id="hospitalReportContent" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Patient Modal -->
    <div class="modal" id="patientModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="patientModalTitle">Add New Patient</h2>
                <button class="modal-close" onclick="closePatientModal()">√ó</button>
            </div>
            <form id="patientForm" onsubmit="savePatient(event)">
                <input type="hidden" id="patientEditId">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Patient Name *</label>
                        <input type="text" id="patientName" required>
                    </div>
                    <div class="form-group">
                        <label>Age *</label>
                        <input type="number" id="patientAge" min="0" max="150" required>
                    </div>
                    <div class="form-group">
                        <label>Gender *</label>
                        <select id="patientGender" required>
                            <option value="">-- Select --</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Phone Number *</label>
                        <input type="tel" id="patientPhone" pattern="[0-9]{10,15}" title="10-15 digits" required>
                    </div>
                    <div class="form-group">
                        <label>NIC Number *</label>
                        <input type="text" id="patientNIC" required>
                    </div>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-success">Save Patient</button>
                    <button type="button" class="btn btn-secondary" onclick="closePatientModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Doctor Modal -->
    <div class="modal" id="doctorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="doctorModalTitle">Add New Doctor</h2>
                <button class="modal-close" onclick="closeDoctorModal()">√ó</button>
            </div>
            <form id="doctorForm" onsubmit="saveDoctor(event)">
                <input type="hidden" id="doctorEditId">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Doctor ID *</label>
                        <input type="text" id="doctorId" required placeholder="e.g., DR001">
                    </div>
                    <div class="form-group">
                        <label>Doctor Name *</label>
                        <input type="text" id="doctorName" required>
                    </div>
                    <div class="form-group">
                        <label>Specialization *</label>
                        <input type="text" id="doctorSpecialization" required>
                    </div>
                    <div class="form-group">
                        <label>Consultation Fee ($) *</label>
                        <input type="number" id="doctorFee" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="doctorStatus">
                            <option value="Active">Active</option>
                            <option value="Inactive">Inactive</option>
                        </select>
                    </div>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-success">Save Doctor</button>
                    <button type="button" class="btn btn-secondary" onclick="closeDoctorModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bill Modal -->
    <div class="modal" id="billModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header no-print">
                <h2>Invoice / Bill</h2>
                <button class="modal-close" onclick="closeBillModal()">√ó</button>
            </div>
            <div id="billContent"></div>
            <div style="margin-top: 20px; display: flex; gap: 10px;" class="no-print">
                <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Print Bill</button>
                <button class="btn btn-secondary" onclick="closeBillModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Data Storage
        let patients = [];
        let doctors = [];
        let appointments = [];
        let activities = [];
        let tokenCounters = {};

        // Initialize
        function init() {
            updateDateTime();
            setInterval(updateDateTime, 60000);
            loadSampleData();
            updateStats();
            renderPatients();
            renderDoctors();
            renderAppointments();
            renderActivities();
            populateDropdowns();
            document.getElementById('reportDate').valueAsDate = new Date();
            document.getElementById('hospitalReportDate').valueAsDate = new Date();
            document.getElementById('svcOther').addEventListener('change', function() {
                document.getElementById('otherServiceGroup').style.display = this.checked ? 'block' : 'none';
            });
        }

        function loadSampleData() {
            doctors = [
                { id: 'DR001', name: 'Dr. John Smith', specialization: 'General Medicine', fee: 100, status: 'Active' },
                { id: 'DR002', name: 'Dr. Sarah Wilson', specialization: 'Pediatrics', fee: 120, status: 'Active' },
                { id: 'DR003', name: 'Dr. Michael Brown', specialization: 'Cardiology', fee: 150, status: 'Active' }
            ];
            patients = [
                { id: 'PAT001', name: 'Alice Johnson', age: 35, gender: 'Female', phone: '0771234567', nic: '901234567V', regDate: '2024-01-15' },
                { id: 'PAT002', name: 'Bob Williams', age: 45, gender: 'Male', phone: '0779876543', nic: '791234567V', regDate: '2024-01-16' }
            ];
            addActivity('System initialized with sample data');
        }

        function updateDateTime() {
            const now = new Date();
            document.getElementById('dateTime').textContent = now.toLocaleDateString('en-US', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        }

        function updateStats() {
            document.getElementById('statPatients').textContent = patients.length;
            document.getElementById('statDoctors').textContent = doctors.filter(d => d.status === 'Active').length;
            const today = new Date().toISOString().split('T')[0];
            const todayAppts = appointments.filter(a => a.date === today);
            document.getElementById('statAppointments').textContent = todayAppts.length;
            const revenue = todayAppts.reduce((sum, a) => sum + a.total, 0);
            document.getElementById('statRevenue').textContent = '$' + revenue.toLocaleString();
        }

        // Navigation
        const menuItems = document.querySelectorAll('.menu-item');
        const pageTitles = { dashboard: 'Dashboard', patients: 'Patient Management', doctors: 'Doctor Management', appointments: 'Appointments & Billing', reports: 'Reports & Analytics' };

        function switchPage(page) {
            menuItems.forEach(item => {
                item.classList.toggle('active', item.getAttribute('data-page') === page);
            });
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.getElementById(page + 'Section').classList.add('active');
            document.getElementById('pageTitle').textContent = pageTitles[page];
            if (page === 'appointments') populateDropdowns();
            if (page === 'reports') populateReportDropdowns();
        }

        menuItems.forEach(item => {
            item.addEventListener('click', () => switchPage(item.getAttribute('data-page')));
        });

        document.getElementById('toggleSidebar').addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('collapsed');
        });

        // Patient Functions
        function openPatientModal(id = null) {
            document.getElementById('patientModal').classList.add('active');
            document.getElementById('patientForm').reset();
            document.getElementById('patientEditId').value = '';
            document.getElementById('patientModalTitle').textContent = 'Add New Patient';
            if (id) {
                const p = patients.find(x => x.id === id);
                if (p) {
                    document.getElementById('patientModalTitle').textContent = 'Edit Patient';
                    document.getElementById('patientEditId').value = p.id;
                    document.getElementById('patientName').value = p.name;
                    document.getElementById('patientAge').value = p.age;
                    document.getElementById('patientGender').value = p.gender;
                    document.getElementById('patientPhone').value = p.phone;
                    document.getElementById('patientNIC').value = p.nic;
                }
            }
        }

        function closePatientModal() { document.getElementById('patientModal').classList.remove('active'); }

        function savePatient(e) {
            e.preventDefault();
            const editId = document.getElementById('patientEditId').value;
            const nic = document.getElementById('patientNIC').value;
            if (!editId && patients.some(p => p.nic === nic)) {
                alert('A patient with this NIC already exists!'); return;
            }
            const data = {
                name: document.getElementById('patientName').value,
                age: parseInt(document.getElementById('patientAge').value),
                gender: document.getElementById('patientGender').value,
                phone: document.getElementById('patientPhone').value,
                nic: nic
            };
            if (editId) {
                const idx = patients.findIndex(p => p.id === editId);
                patients[idx] = { ...patients[idx], ...data };
                addActivity(`Patient updated: ${data.name}`);
            } else {
                data.id = 'PAT' + String(patients.length + 1).padStart(3, '0');
                data.regDate = new Date().toISOString().split('T')[0];
                patients.push(data);
                addActivity(`New patient registered: ${data.name}`);
            }
            closePatientModal();
            renderPatients();
            updateStats();
            populateDropdowns();
        }

        function deletePatient(id) {
            if (confirm('Delete this patient?')) {
                patients = patients.filter(p => p.id !== id);
                renderPatients();
                updateStats();
                addActivity(`Patient deleted: ${id}`);
            }
        }

        function renderPatients(list = patients) {
            document.getElementById('patientsTable').innerHTML = list.map(p => `
                <tr>
                    <td>${p.id}</td><td>${p.name}</td><td>${p.age}</td><td>${p.gender}</td>
                    <td>${p.phone}</td><td>${p.nic}</td><td>${p.regDate}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="openPatientModal('${p.id}')">Edit</button>
                        <button class="btn btn-sm btn-danger" onclick="deletePatient('${p.id}')">Delete</button>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="8" style="text-align:center;">No patients found</td></tr>';
        }

        function searchPatients() {
            const q = document.getElementById('patientSearch').value.toLowerCase();
            renderPatients(patients.filter(p => p.name.toLowerCase().includes(q) || p.nic.toLowerCase().includes(q) || p.phone.includes(q)));
        }

        // Doctor Functions
        function openDoctorModal(id = null) {
            document.getElementById('doctorModal').classList.add('active');
            document.getElementById('doctorForm').reset();
            document.getElementById('doctorEditId').value = '';
            document.getElementById('doctorModalTitle').textContent = 'Add New Doctor';
            document.getElementById('doctorId').readOnly = false;
            if (id) {
                const d = doctors.find(x => x.id === id);
                if (d) {
                    document.getElementById('doctorModalTitle').textContent = 'Edit Doctor';
                    document.getElementById('doctorEditId').value = d.id;
                    document.getElementById('doctorId').value = d.id;
                    document.getElementById('doctorId').readOnly = true;
                    document.getElementById('doctorName').value = d.name;
                    document.getElementById('doctorSpecialization').value = d.specialization;
                    document.getElementById('doctorFee').value = d.fee;
                    document.getElementById('doctorStatus').value = d.status;
                }
            }
        }

        function closeDoctorModal() { document.getElementById('doctorModal').classList.remove('active'); }

        function saveDoctor(e) {
            e.preventDefault();
            const editId = document.getElementById('doctorEditId').value;
            const docId = document.getElementById('doctorId').value;
            if (!editId && doctors.some(d => d.id === docId)) {
                alert('A doctor with this ID already exists!'); return;
            }
            const data = {
                id: docId,
                name: document.getElementById('doctorName').value,
                specialization: document.getElementById('doctorSpecialization').value,
                fee: parseFloat(document.getElementById('doctorFee').value),
                status: document.getElementById('doctorStatus').value
            };
            if (editId) {
                const idx = doctors.findIndex(d => d.id === editId);
                doctors[idx] = data;
                addActivity(`Doctor profile updated: ${data.name}`);
            } else {
                doctors.push(data);
                addActivity(`New doctor added: ${data.name}`);
            }
            closeDoctorModal();
            renderDoctors();
            updateStats();
            populateDropdowns();
        }

        function toggleDoctorStatus(id) {
            const d = doctors.find(x => x.id === id);
            d.status = d.status === 'Active' ? 'Inactive' : 'Active';
            renderDoctors();
            updateStats();
            addActivity(`Doctor ${d.name} status changed to ${d.status}`);
        }

        function renderDoctors(list = doctors) {
            document.getElementById('doctorsTable').innerHTML = list.map(d => `
                <tr>
                    <td>${d.id}</td><td>${d.name}</td><td>${d.specialization}</td><td>$${d.fee}</td>
                    <td><span class="status-badge status-${d.status.toLowerCase()}">${d.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="openDoctorModal('${d.id}')">Edit</button>
                        <button class="btn btn-sm btn-secondary" onclick="toggleDoctorStatus('${d.id}')">${d.status === 'Active' ? 'Deactivate' : 'Activate'}</button>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="6" style="text-align:center;">No doctors found</td></tr>';
        }

        function searchDoctors() {
            const q = document.getElementById('doctorSearch').value.toLowerCase();
            renderDoctors(doctors.filter(d => d.name.toLowerCase().includes(q) || d.specialization.toLowerCase().includes(q)));
        }

        // Appointment Functions
        function showAppointmentTab(tab) {
            document.querySelectorAll('#appointmentsSection .tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('appointmentNewTab').style.display = tab === 'new' ? 'block' : 'none';
            document.getElementById('appointmentListTab').style.display = tab === 'list' ? 'block' : 'none';
            document.getElementById('appointmentAllTab').style.display = tab === 'all' ? 'block' : 'none';
            if (tab === 'list' || tab === 'all') renderAppointments();
        }

        function populateDropdowns() {
            const patientSelect = document.getElementById('appointmentPatient');
            const doctorSelect = document.getElementById('appointmentDoctor');
            patientSelect.innerHTML = '<option value="">-- Select Patient --</option>' + patients.map(p => `<option value="${p.id}">${p.name} (${p.nic})</option>`).join('');
            doctorSelect.innerHTML = '<option value="">-- Select Doctor --</option>' + doctors.filter(d => d.status === 'Active').map(d => `<option value="${d.id}">${d.name} - ${d.specialization}</option>`).join('');
        }

        function populateReportDropdowns() {
            document.getElementById('reportDoctor').innerHTML = '<option value="">-- All Doctors --</option>' + doctors.map(d => `<option value="${d.id}">${d.name}</option>`).join('');
        }

        function fillPatientDetails() {
            const p = patients.find(x => x.id === document.getElementById('appointmentPatient').value);
            document.getElementById('appointmentPatientName').value = p ? p.name : '';
            document.getElementById('appointmentPatientAge').value = p ? p.age : '';
        }

        function fillDoctorDetails() {
            const d = doctors.find(x => x.id === document.getElementById('appointmentDoctor').value);
            document.getElementById('appointmentSpecialization').value = d ? d.specialization : '';
            document.getElementById('appointmentDoctorFee').value = d ? '$' + d.fee : '';
        }

        function generateToken(doctorId) {
            const today = new Date().toISOString().split('T')[0].replace(/-/g, '');
            const key = doctorId + '-' + today;
            tokenCounters[key] = (tokenCounters[key] || 0) + 1;
            return `${doctorId}-${today}-${String(tokenCounters[key]).padStart(3, '0')}`;
        }

        function createAppointment() {
            const patientId = document.getElementById('appointmentPatient').value;
            const doctorId = document.getElementById('appointmentDoctor').value;
            if (!patientId || !doctorId) { alert('Please select both patient and doctor'); return; }
            
            const patient = patients.find(p => p.id === patientId);
            const doctor = doctors.find(d => d.id === doctorId);
            const hospitalCharges = parseFloat(document.getElementById('hospitalCharges').value) || 0;
            
            let additionalServices = [];
            let additionalTotal = 0;
            if (document.getElementById('svcDressing').checked) { additionalServices.push({ name: 'Dressing', amount: 25 }); additionalTotal += 25; }
            if (document.getElementById('svcScanning').checked) { additionalServices.push({ name: 'Scanning', amount: 150 }); additionalTotal += 150; }
            if (document.getElementById('svcBlood').checked) { additionalServices.push({ name: 'Blood Testing', amount: 75 }); additionalTotal += 75; }
            if (document.getElementById('svcECG').checked) { additionalServices.push({ name: 'ECG', amount: 100 }); additionalTotal += 100; }
            if (document.getElementById('svcOther').checked) {
                const otherAmt = parseFloat(document.getElementById('otherServiceAmount').value) || 0;
                if (otherAmt > 0) { additionalServices.push({ name: 'Other Services', amount: otherAmt }); additionalTotal += otherAmt; }
            }
            
            const total = doctor.fee + hospitalCharges + additionalTotal;
            const token = generateToken(doctorId);
            const now = new Date();
            
            const appointment = {
                token, patientId, doctorId,
                patientName: patient.name, patientAge: patient.age, patientNIC: patient.nic, patientPhone: patient.phone,
                doctorName: doctor.name, doctorSpecialization: doctor.specialization,
                doctorFee: doctor.fee, hospitalCharges, additionalServices, additionalTotal, total,
                date: now.toISOString().split('T')[0],
                time: now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })
            };
            
            appointments.push(appointment);
            addActivity(`Appointment created: ${patient.name} with ${doctor.name} - Token: ${token}`);
            updateStats();
            renderAppointments();
            showBill(appointment);
            
            // Reset form
            document.getElementById('appointmentPatient').value = '';
            document.getElementById('appointmentDoctor').value = '';
            fillPatientDetails();
            fillDoctorDetails();
            document.querySelectorAll('#appointmentsSection input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.getElementById('otherServiceGroup').style.display = 'none';
        }

        function showBill(appt) {
            const additionalList = appt.additionalServices.map(s => `<div class="bill-row"><span>${s.name}</span><span>$${s.amount}</span></div>`).join('');
            document.getElementById('billContent').innerHTML = `
                <div class="bill-section">
                    <div class="bill-header">
                        <h2 style="color:#1e40af;">üè• HMS Medical Center</h2>
                        <p style="color:#64748b;">Invoice / Receipt</p>
                    </div>
                    <div class="token-display">
                        <div style="font-size:14px;">Token Number</div>
                        <div class="token-number">${appt.token}</div>
                    </div>
                    <div style="margin: 15px 0; padding: 15px; background: #f8fafc; border-radius: 8px;">
                        <strong>Patient:</strong> ${appt.patientName} (Age: ${appt.patientAge})<br>
                        <strong>NIC:</strong> ${appt.patientNIC} | <strong>Phone:</strong> ${appt.patientPhone}<br>
                        <strong>Doctor:</strong> ${appt.doctorName} (${appt.doctorSpecialization})<br>
                        <strong>Date:</strong> ${appt.date} | <strong>Time:</strong> ${appt.time}
                    </div>
                    <h4 style="margin: 15px 0 10px;">Charges Breakdown</h4>
                    <div class="bill-row"><span>Doctor Consultation Fee</span><span>$${appt.doctorFee}</span></div>
                    <div class="bill-row"><span>Hospital Charges</span><span>$${appt.hospitalCharges}</span></div>
                    ${additionalList}
                    <div class="bill-row bill-total"><span>TOTAL AMOUNT</span><span>$${appt.total}</span></div>
                </div>
            `;
            document.getElementById('billModal').classList.add('active');
        }

        function closeBillModal() { document.getElementById('billModal').classList.remove('active'); }

        function renderAppointments() {
            const today = new Date().toISOString().split('T')[0];
            const todayAppts = appointments.filter(a => a.date === today);
            document.getElementById('todayAppointmentsTable').innerHTML = todayAppts.map(a => `
                <tr>
                    <td><strong>${a.token}</strong></td><td>${a.patientName}</td><td>${a.doctorName}</td>
                    <td>${a.time}</td><td>$${a.total}</td>
                    <td><button class="btn btn-sm btn-primary" onclick='showBill(${JSON.stringify(a)})'>View Bill</button></td>
                </tr>
            `).join('') || '<tr><td colspan="6" style="text-align:center;">No appointments today</td></tr>';
            
            document.getElementById('allAppointmentsTable').innerHTML = appointments.slice().reverse().map(a => `
                <tr>
                    <td><strong>${a.token}</strong></td><td>${a.patientName}</td><td>${a.doctorName}</td>
                    <td>${a.date}</td><td>$${a.total}</td>
                    <td><button class="btn btn-sm btn-primary" onclick='showBill(${JSON.stringify(a)})'>View Bill</button></td>
                </tr>
            `).join('') || '<tr><td colspan="6" style="text-align:center;">No appointments found</td></tr>';
        }

        // Reports
        function showReportTab(tab) {
            document.querySelectorAll('#reportsSection .tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('doctorReportTab').style.display = tab === 'doctor' ? 'block' : 'none';
            document.getElementById('hospitalReportTab').style.display = tab === 'hospital' ? 'block' : 'none';
        }

        function generateDoctorReport() {
            const doctorId = document.getElementById('reportDoctor').value;
            const date = document.getElementById('reportDate').value;
            let filtered = appointments.filter(a => a.date === date);
            if (doctorId) filtered = filtered.filter(a => a.doctorId === doctorId);
            
            const totalConsultation = filtered.reduce((s, a) => s + a.doctorFee, 0);
            const patientList = filtered.map(a => a.patientName).join(', ') || 'None';
            const doctor = doctorId ? doctors.find(d => d.id === doctorId) : null;
            
            document.getElementById('doctorReportContent').style.display = 'block';
            document.getElementById('doctorReportContent').innerHTML = `
                <div class="card-title">üìä Doctor Report - ${date}</div>
                ${doctor ? `<p><strong>Doctor:</strong> ${doctor.name} (${doctor.specialization})</p>` : '<p><strong>All Doctors</strong></p>'}
                <div style="margin: 20px 0; padding: 20px; background: #f8fafc; border-radius: 10px;">
                    <div class="bill-row"><span>Total Appointments</span><span><strong>${filtered.length}</strong></span></div>
                    <div class="bill-row"><span>Patients Attended</span><span>${patientList}</span></div>
                    <div class="bill-row"><span>Total Consultation Fees</span><span><strong>$${totalConsultation}</strong></span></div>
                    <div class="bill-row"><span>Report Generated</span><span>${new Date().toLocaleString()}</span></div>
                </div>
                <button class="btn btn-primary no-print" onclick="window.print()">üñ®Ô∏è Print Report</button>
            `;
        }

        function generateHospitalReport() {
            const date = document.getElementById('hospitalReportDate').value;
            const filtered = appointments.filter(a => a.date === date);
            
            const totalDoctorFees = filtered.reduce((s, a) => s + a.doctorFee, 0);
            const totalHospitalCharges = filtered.reduce((s, a) => s + a.hospitalCharges, 0);
            const totalAdditional = filtered.reduce((s, a) => s + a.additionalTotal, 0);
            const grandTotal = filtered.reduce((s, a) => s + a.total, 0);
            
            const doctorSummary = {};
            filtered.forEach(a => {
                doctorSummary[a.doctorName] = (doctorSummary[a.doctorName] || 0) + 1;
            });
            
            document.getElementById('hospitalReportContent').style.display = 'block';
            document.getElementById('hospitalReportContent').innerHTML = `
                <div class="card-title">üè• Daily Hospital Report - ${date}</div>
                <div style="margin: 20px 0; padding: 20px; background: #f8fafc; border-radius: 10px;">
                    <div class="bill-row"><span>Total Patients</span><span><strong>${filtered.length}</strong></span></div>
                    <div class="bill-row"><span>Total Doctor Fees</span><span>$${totalDoctorFees}</span></div>
                    <div class="bill-row"><span>Total Hospital Charges</span><span>$${totalHospitalCharges}</span></div>
                    <div class="bill-row"><span>Total Additional Services</span><span>$${totalAdditional}</span></div>
                    <div class="bill-row bill-total"><span>GRAND TOTAL REVENUE</span><span>$${grandTotal}</span></div>
                </div>
                <h4>Doctor-wise Summary</h4>
                <div style="margin: 15px 0; padding: 15px; background: #f8fafc; border-radius: 8px;">
                    ${Object.entries(doctorSummary).map(([name, count]) => `<div class="bill-row"><span>${name}</span><span>${count} appointments</span></div>`).join('') || '<p>No data</p>'}
                </div>
                <p style="color:#64748b; font-size: 13px;">Report Generated: ${new Date().toLocaleString()}</p>
                <button class="btn btn-primary no-print" onclick="window.print()">üñ®Ô∏è Print Report</button>
            `;
        }

        // Activity Log
        function addActivity(text) {
            activities.unshift({ text, time: new Date() });
            if (activities.length > 10) activities.pop();
            renderActivities();
        }

        function renderActivities() {
            const icons = { patient: '<path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>', appointment: '<path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>', default: '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>' };
            document.getElementById('activityList').innerHTML = activities.map(a => {
                const icon = a.text.toLowerCase().includes('patient') ? icons.patient : a.text.toLowerCase().includes('appointment') ? icons.appointment : icons.default;
                const timeAgo = getTimeAgo(a.time);
                return `<div class="activity-item"><div class="activity-icon"><svg viewBox="0 0 24 24">${icon}</svg></div><div><div class="activity-title">${a.text}</div><div class="activity-time">${timeAgo}</div></div></div>`;
            }).join('') || '<p style="color:#64748b; padding: 20px;">No recent activity</p>';
        }

        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return Math.floor(seconds / 60) + ' minutes ago';
            if (seconds < 86400) return Math.floor(seconds / 3600) + ' hours ago';
            return Math.floor(seconds / 86400) + ' days ago';
        }

        init();
    </script>
</body>
</html>